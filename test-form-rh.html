<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste Formulário RH</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { padding: 8px; width: 200px; margin-right: 10px; }
        button { padding: 10px 20px; background: #FF002D; color: white; border: none; cursor: pointer; }
        .investment-item { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .resultado { background: #e8f5e9; padding: 15px; margin: 20px 0; border-radius: 5px; }
        #debug { background: #fff3cd; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste Seção 11.4 - Planos de Contratação</h1>
        
        <div id="contratacoesList"></div>
        
        <button onclick="addContratacao()">+ Adicionar Contratação</button>
        
        <div class="form-group">
            <label>Encargos e Benefícios (%)</label>
            <input type="number" id="encargosBeneficios" value="85" min="0" step="0.1">
        </div>
        
        <div class="resultado">
            <h3>Resultados</h3>
            <p><strong>Novas Contratações:</strong> <span id="novasContratacoes">0</span></p>
            <p><strong>Investimento Previsto em RH:</strong> <span id="investimentoRH">R$ 0,00</span></p>
        </div>
        
        <div id="debug">
            <h4>Debug</h4>
            <pre id="debugInfo"></pre>
        </div>
        
        <button onclick="preencherDadosTeste()">Preencher com Dados do PDF</button>
    </div>

    <script>
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function parseMonetaryValue(value) {
            if (!value) return 0;
            if (typeof value === 'number') return value;
            
            let cleanValue = value.toString()
                .replace(/R\$/g, '')
                .replace(/\s/g, '')
                .trim();
            
            // Formato brasileiro: ponto para milhar, vírgula para decimal
            cleanValue = cleanValue.replace(/\./g, '').replace(',', '.');
            
            const parsed = parseFloat(cleanValue);
            return isNaN(parsed) ? 0 : parsed;
        }

        function applyMoneyFormatting(input) {
            input.addEventListener('blur', function() {
                const value = parseMonetaryValue(this.value);
                if (value > 0) {
                    this.value = formatCurrency(value);
                }
            });
            
            input.addEventListener('focus', function() {
                const value = parseMonetaryValue(this.value);
                if (value > 0) {
                    this.value = value.toString();
                }
            });
        }

        let contratacaoId = 0;

        function addContratacao(cargo = '', quantidade = '', salario = '') {
            contratacaoId++;
            const list = document.getElementById('contratacoesList');
            
            const item = document.createElement('div');
            item.className = 'investment-item';
            item.id = `contratacao-${contratacaoId}`;
            item.innerHTML = `
                <input type="text" placeholder="Cargo" class="cargo" value="${cargo}">
                <input type="number" placeholder="Qtd" class="quantidade" value="${quantidade}" min="1">
                <input type="text" placeholder="Salário" class="salario" value="${salario}">
                <button onclick="removeContratacao(${contratacaoId})">×</button>
            `;
            
            list.appendChild(item);
            
            const salarioInput = item.querySelector('.salario');
            const quantidadeInput = item.querySelector('.quantidade');
            
            applyMoneyFormatting(salarioInput);
            salarioInput.addEventListener('input', calculateTotal);
            quantidadeInput.addEventListener('input', calculateTotal);
            
            calculateTotal();
        }

        function removeContratacao(id) {
            document.getElementById(`contratacao-${id}`).remove();
            calculateTotal();
        }

        function calculateTotal() {
            const items = document.querySelectorAll('.investment-item');
            let totalInvestimento = 0;
            let totalContratacoes = 0;
            let debugInfo = [];
            
            items.forEach((item, index) => {
                const cargo = item.querySelector('.cargo').value || `Item ${index + 1}`;
                const quantidade = parseInt(item.querySelector('.quantidade').value) || 0;
                const salarioStr = item.querySelector('.salario').value;
                const salario = parseMonetaryValue(salarioStr);
                
                const subtotal = quantidade * salario;
                totalInvestimento += subtotal;
                totalContratacoes += quantidade;
                
                debugInfo.push({
                    cargo,
                    quantidade,
                    salarioStr,
                    salarioParsed: salario,
                    subtotal
                });
            });
            
            const encargos = parseFloat(document.getElementById('encargosBeneficios').value) || 0;
            const totalComEncargos = totalInvestimento * (1 + (encargos / 100));
            
            // Atualizar display
            document.getElementById('novasContratacoes').textContent = totalContratacoes;
            document.getElementById('investimentoRH').textContent = formatCurrency(totalComEncargos);
            
            // Debug
            document.getElementById('debugInfo').textContent = JSON.stringify({
                itens: debugInfo,
                totalBase: totalInvestimento,
                encargos: encargos + '%',
                totalComEncargos: totalComEncargos,
                formatado: formatCurrency(totalComEncargos)
            }, null, 2);
        }

        function preencherDadosTeste() {
            // Limpar lista atual
            document.getElementById('contratacoesList').innerHTML = '';
            
            // Adicionar contratações do PDF
            addContratacao('Operador de CNC', '30', '3500');
            addContratacao('Técnico de Automação', '8', '5200');
            addContratacao('Engenheiro de Processos', '3', '9000');
            addContratacao('Analista de Qualidade', '5', '4000');
        }

        // Event listener para encargos
        document.getElementById('encargosBeneficios').addEventListener('input', calculateTotal);
    </script>
</body>
</html>